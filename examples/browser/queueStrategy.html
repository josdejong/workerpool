<!DOCTYPE html>
<html>
<head>
  <title>Queue Strategy Examples</title>
  <style>
    body {
      width: 800px;
      font: 11pt arial;
    }
    button {
      margin: 5px;
      padding: 5px 10px;
    }
    .output {
      background: #f5f5f5;
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 10pt;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>

  <script src="../../dist/workerpool.js"></script>
</head>
<body>

<h2>Queue Strategy Examples</h2>
<p>Demonstration of FIFO, LIFO, and Priority queue strategies with single worker.</p>

<button onclick="runFIFO()">FIFO Queue</button>
<button onclick="runLIFO()">LIFO Queue</button>
<button onclick="runPriority()">Priority Queue</button>
<button onclick="clearResults()">Clear</button>

<div id="results" class="output"></div>

<script>
  var results = document.getElementById('results');

  // Simple priority queue implementation
  function PriorityQueue() {
    this.tasks = [];
  }
  PriorityQueue.prototype.push = function(task) {
    this.tasks.push(task);
    var self = this;
    this.tasks.sort(function(a, b) {
      var priorityA = (a.options && a.options.metadata && a.options.metadata.priority) || 5;
      var priorityB = (b.options && b.options.metadata && b.options.metadata.priority) || 5;
      return priorityA - priorityB;
    });
  };
  PriorityQueue.prototype.pop = function() { return this.tasks.shift(); };
  PriorityQueue.prototype.size = function() { return this.tasks.length; };
  PriorityQueue.prototype.contains = function(task) { return this.tasks.includes(task); };
  PriorityQueue.prototype.clear = function() { this.tasks.length = 0; };

  function log(message) {
    results.innerHTML += message + '<br>';
    results.scrollTop = results.scrollHeight;
  }

  function clearResults() {
    results.innerHTML = '';
  }

  // Simple task function
  function delayedTask(taskName, duration) {
    return new Promise(function (resolve) {
      setTimeout(function () {
        resolve(taskName + " completed (took " + duration + "ms)");
      }, duration);
    });
  }

  function runFIFO() {
    log('<strong>FIFO Queue Example</strong>');
    var pool = workerpool.pool({
      maxWorkers: 1,
      queueStrategy: 'fifo'
    });

    var start = Date.now();
    Promise.all([
      pool.exec(delayedTask, ['A', 100]),
      pool.exec(delayedTask, ['B', 50]), 
      pool.exec(delayedTask, ['C', 30]),
      pool.exec(delayedTask, ['D', 20])
    ]).then(function(results) {
      results.forEach(function(result) { log('✓ ' + result); });
      log('Total: ' + (Date.now() - start) + 'ms - Order: A, B, C, D');
      pool.terminate();
    });
  }

  function runLIFO() {
    log('<strong>LIFO Queue Example</strong>');
    var pool = workerpool.pool({
      maxWorkers: 1,
      queueStrategy: 'lifo'
    });

    var start = Date.now();
    Promise.all([
      pool.exec(delayedTask, ['A', 100]),
      pool.exec(delayedTask, ['B', 50]),
      pool.exec(delayedTask, ['C', 30]),
      pool.exec(delayedTask, ['D', 20])
    ]).then(function(results) {
      results.forEach(function(result) { log('✓ ' + result); });
      log('Total: ' + (Date.now() - start) + 'ms - Order: A, D, C, B');
      pool.terminate();
    });
  }

  function runPriority() {
    log('<strong>Priority Queue Example</strong>');
    var pool = workerpool.pool({
      maxWorkers: 1,
      queueStrategy: new PriorityQueue()
    });

    var start = Date.now();
    Promise.all([
      pool.exec(delayedTask, ['A', 100], { metadata: { priority: 3 } }),
      pool.exec(delayedTask, ['B', 50], { metadata: { priority: 1 } }),
      pool.exec(delayedTask, ['C', 30], { metadata: { priority: 4 } }),
      pool.exec(delayedTask, ['D', 20], { metadata: { priority: 2 } })
    ]).then(function(results) {
      results.forEach(function(result) { log('✓ ' + result); });
      log('Total: ' + (Date.now() - start) + 'ms - Order: A, B(1), D(2), C(4)');
      pool.terminate();
    });
  }
</script>

</body>
</html>